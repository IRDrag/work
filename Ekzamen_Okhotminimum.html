<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Экзамен по знанию охотминиума</title>
    <style>
        :root {
            --primary-bg: #f0f4f0; --container-bg: #ffffff; --border-color: #d1d1d1;
            --text-color: #333; --button-bg: #2e7d32; --button-hover-bg: #1b5e20;
            --pass-color: #28a745; --fail-color: #dc3545; --link-color: #0d47a1;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--primary-bg); color: var(--text-color); display: flex;
            justify-content: center; align-items: center; min-height: 100vh;
            margin: 0; padding: 20px 0;
            -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;
        }
        .container {
            width: 90%; max-width: 800px; background-color: var(--container-bg); padding: 30px 40px;
            border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); text-align: center;
        }
        #mainTitle { cursor: default; }
        .question { margin-bottom: 25px; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; text-align: left; }
        .options label { display: block; margin-bottom: 12px; padding: 10px; border-radius: 5px; cursor: pointer; transition: background-color 0.2s; }
        .options label:hover { background-color: #f0f0f0; }
        .input-group { margin-bottom: 15px; }
        input[type="text"] { width: calc(100% - 22px); max-width: 400px; padding: 10px; border: 1px solid var(--border-color); border-radius: 5px; }
        button { font-size: 16px; padding: 12px 25px; cursor: pointer; border: none; border-radius: 5px; color: white; background-color: var(--button-bg); transition: background-color 0.2s; margin: 5px; }
        button:hover { background-color: var(--button-hover-bg); }
        .secondary-button { background-color: #6c757d; }
        .secondary-button:hover { background-color: #5a6268; }
        h2, h3, h4 { text-align: center; }
        #timer, #progress-indicator {
            position: fixed; top: 20px; font-size: 20px; font-weight: bold; background-color: var(--container-bg);
            padding: 10px 15px; border-radius: 5px; border: 1px solid var(--border-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: none; z-index: 100;
        }
        #timer { right: 20px; }
        #progress-indicator { left: 20px; font-size: 16px; }
        .pass { color: var(--pass-color); } .fail { color: var(--fail-color); }
        #protocol-header { text-align: left; margin-bottom: 20px; }
        .protocol-line { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; }
        .protocol-label { font-weight: bold; padding-right: 15px; }
        .protocol-verdict { text-align: center; margin-top: 20px; }
        #errorReview { margin-top: 20px; border-top: 1px dashed var(--border-color); padding-top: 20px; text-align: left; }
        .error-item { margin-bottom: 15px; }
        .user-answer-wrong { color: var(--fail-color); font-weight: bold; }
        .correct-answer { color: var(--pass-color); font-weight: bold; }
        .help-toggle { color: var(--link-color); cursor: pointer; text-decoration: underline; font-size: 14px; margin-top: 15px; display: inline-block; }
        #saveHelpText { text-align: left; background-color: #f8f9fa; border: 1px solid var(--border-color); padding: 15px; margin-top: 10px; border-radius: 5px; }
        .error-message { color: var(--fail-color); font-size: 14px; text-align: center; margin-top: 5px; display: none; }
        .input-error { border-color: var(--fail-color); box-shadow: 0 0 0 2px rgba(220, 53, 69, 0.2); }
        #log-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 200; display: none; justify-content: center; align-items: center; }
        #log-container { background-color: white; padding: 20px; border-radius: 8px; width: 90%; max-width: 900px; max-height: 80%; overflow-y: auto; }
        #log-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        #log-table th, #log-table td { border: 1px solid var(--border-color); padding: 8px; text-align: left; }
        #log-table th { background-color: #f2f2f2; }
        .close-btn { float: right; font-size: 24px; cursor: pointer; }
        @media print {
            body { background-color: white; padding: 0; user-select: auto; }
            .container { box-shadow: none; border: none; width: 100%; max-width: 100%; padding: 0; }
            #setup, #quiz, #submitBtn, #timer, #screen-only-content, #progress-indicator { display: none !important; }
            #results { display: block !important; }
            #protocol-header p { text-align: left; }
        }
    </style>
</head>
<body onload="checkForSavedTest()">

    <div id="timer"></div>
    <div id="progress-indicator"></div>
    <div class="container">
        <div id="startScreen">
            <h2 id="mainTitle">Экзамен по знанию охотминиума</h2>
            <button onclick="initiateTest()">Начать</button>
        </div>

        <div id="setup" style="display:none;">
            <p id="timeWarning"></p>
            <div class="input-group">
                <label for="userName">Фамилия, Имя, Отчество:</label><br>
                <input type="text" id="userName" placeholder="ФИО" required pattern="[А-Яа-яЁё\s,-]+" title="Пожалуйста, проверьте правильность ввода ФИО.">
                <p class="error-message" id="userNameError"></p>
            </div>
            <div class="input-group">
                <label for="userPassport">Серия и номер паспорта:</label><br>
                <input type="text" id="userPassport" placeholder="1234 567890" required pattern="\d{4}\s\d{6}" maxlength="11" inputmode="numeric" title="Формат: 4 цифры, пробел, 6 цифр.">
                <p class="error-message" id="userPassportError"></p>
            </div>
            <button onclick="startTest()">Начать тест</button>
        </div>

        <div id="quiz" style="display:none;"></div>
        <button id="submitBtn" style="display:none;" onclick="showResults(null)">Завершить экзамен</button>

        <div id="results" style="display:none;"></div>
    </div>
    
    <div id="log-modal">
        <div id="log-container">
            <span class="close-btn" onclick="closeLog()">&times;</span>
            <h2>Журнал результатов</h2>
            <p>Отображены последние 50 записей. Для просмотра протокола нажмите "Просмотр".</p>
            <div id="log-table-container"></div>
        </div>
    </div>

<script>
    const QUESTIONS_TO_SHOW = 100;
    const TIME_FOR_TEST_MINUTES = 100;
    const PASS_PERCENTAGE = 75;
    const questionBank = [
        {
            question: "К охоте приравнивается нахождение в охотничьих угодьях физических лиц с:",
            options: ["только с охотничьим огнестрельным оружием", "орудиями охоты и (или) продукцией охоты, собаками охотничьих пород, ловчими птицами", "только с продукцией охоты"],
            correct: "орудиями охоты и (или) продукцией охоты, собаками охотничьих пород, ловчими птицами"
        },
        {
            question: "Не приравнивается к охоте нахождение в охотничьих угодьях с охотничьим огнестрельным оружием:",
            options: ["любых физических лиц", "должностных лиц при осуществлении федерального государственного охотничьего контроля (надзора) и производственных охотничьих инспекторов при осуществлении производственного охотничьего контроля", "охотников с действующими разрешениями"],
            correct: "должностных лиц при осуществлении федерального государственного охотничьего контроля (надзора) и производственных охотничьих инспекторов при осуществлении производственного охотничьего контроля"
        },
        {
            question: "При осуществлении охоты физическое лицо обязано иметь при себе:",
            options: ["только охотничий билет", "только разрешение на добычу охотничьих ресурсов", "охотничий билет и разрешение на добычу охотничьих ресурсов, выданное в соответствии с установленным порядком"],
            correct: "охотничий билет и разрешение на добычу охотничьих ресурсов, выданное в соответствии с установленным порядком"
        },
        {
            question: "При осуществлении охоты в общедоступных охотничьих угодьях физическое лицо обязано иметь при себе:",
            options: ["охотничий билет и разрешение на добычу охотничьих ресурсов, выданное в соответствии с установленным порядком", "только охотничий билет", "путевка и разрешение на добычу"],
            correct: "охотничий билет и разрешение на добычу охотничьих ресурсов, выданное в соответствии с установленным порядком"
        },
        {
            question: "При осуществлении охоты в закрепленных охотничьих угодьях дополнительно к охотничьему билету и разрешению на добычу охотничьих ресурсов, выданному в соответствии с установленным порядком, физическое лицо обязано иметь при себе:",
            options: ["путевку", "справку о прохождении медосмотра", "страховой полис"],
            correct: "путевку"
        },
        {
            question: "Реализация продукции охоты производится при наличии:",
            options: ["справки о качестве продукции", "разрешения на добычу охотничьих ресурсов с заполненными сведениями о добыче таких охотничьих ресурсов и их количестве или заполненного отрывного талона к указанному разрешению на добычу охотничьих ресурсов", "только товарного чека"],
            correct: "разрешения на добычу охотничьих ресурсов с заполненными сведениями о добыче таких охотничьих ресурсов и их количестве или заполненного отрывного талона к указанному разрешению на добычу охотничьих ресурсов"
        },
        {
            question: "Заполненный отрывной талон к разрешению на добычу охотничьих ресурсов используется для:",
            options: ["учета добытых животных", "транспортировки продукции охоты наравне с заполненным разрешением на добычу охотничьих ресурсов", "получения новых разрешений на добычу охотничьих ресурсов"],
            correct: "транспортировки продукции охоты наравне с заполненным разрешением на добычу охотничьих ресурсов"
        },
        {
            question: "При осуществлении коллективной охоты на копытных животных в закрепленных охотничьих угодьях путевка выдается:",
            options: ["каждому участнику охоты", "лицу, получившему в установленном порядке разрешение на добычу охотничьих ресурсов", "старшему по возрасту охотнику"],
            correct: "лицу, получившему в установленном порядке разрешение на добычу охотничьих ресурсов"
        },
        {
            question: "При осуществлении коллективной охоты на медведей список лиц, участвующих в коллективной охоте должен содержать:",
            options: ["только количество участников", "фамилии и инициалы, серии и номера охотничьих билетов лиц, участвующих в коллективной охоте", "только данные руководителя группы"],
            correct: "фамилии и инициалы, серии и номера охотничьих билетов лиц, участвующих в коллективной охоте"
        },
        {
            question: "Коллективная охота на волка в закрепленных охотничьих угодьях требует:",
            options: ["специального разрешения администрации охотничьего хозяйства", "путевки, выданной лицу, получившему в установленном порядке разрешение на добычу охотничьих ресурсов", "только согласования с егерской службой"],
            correct: "путевки, выданной лицу, получившему в установленном порядке разрешение на добычу охотничьих ресурсов"
        },
        {
            question: "При осуществлении охоты применение сетей и других ловчих приспособлений из сетей:",
            options: ["разрешено без ограничений", "запрещено, за исключением случаев установленных Правилами охоты", "разрешено только для промысловой охоты"],
            correct: "запрещено, за исключением случаев установленных Правилами охоты"
        },
        {
            question: "При осуществлении охоты на водоплавающую дичь использование сетей:",
            options: ["запрещено, за исключением случаев установленных Правилами охоты", "разрешено без ограничений", "разрешено только в весенний период"],
            correct: "запрещено, за исключением случаев установленных Правилами охоты"
        },
        {
            question: "Сроки охоты на кабана (все половозрастные группы):",
            options: ["с 1 августа по 31 января", "с 1 июня по 28 (29) февраля (продолжительностью не менее 210 дней)", "с 15 сентября по 10 января"],
            correct: "с 1 июня по 28 (29) февраля (продолжительностью не менее 210 дней)"
        },
        {
            question: "Охота на лося (все половозрастные группы) разрешена в период:",
            options: ["с 1 октября по 10 января", "с 15 сентября по 10 января", "с 1 августа по 31 декабря"],
            correct: "с 15 сентября по 10 января"
        },
        {
            question: "Сроки охоты на взрослых самцов лося:",
            options: ["с 1 сентября по 30 сентября", "с 15 сентября по 10 января", "с 1 октября по 31 октября"],
            correct: "с 1 сентября по 30 сентября"
        },
        {
            question: "Сроки охоты на волка:",
            options: ["с 15 сентября по 28 февраля", "с 1 октября по 31 марта", "с 1 августа по 31 марта"],
            correct: "с 1 августа по 31 марта"
        },
        {
            question: "Сроки охоты на лисицу:",
            options: ["с 1 октября по 31 марта", "с 15 сентября по 28 (29) февраля", "с 1 августа по 31 декабря"],
            correct: "с 15 сентября по 28 (29) февраля"
        },
        {
            question: "Охота на белку разрешена в период:",
            options: ["с 1 октября по 31 января", "с 15 октября по 28 (29) февраля (продолжительностью не менее 120 дней)", "с 1 сентября по 31 декабря"],
            correct: "с 15 октября по 28 (29) февраля (продолжительностью не менее 120 дней)"
        },
        {
            question: "Сроки охоты на барсука:",
            options: ["с 1 сентября по 31 октября", "с 15 августа по 31 октября", "с 1 октября по 30 ноября"],
            correct: "с 15 августа по 31 октября"
        },
        {
            question: "Сроки охоты на косулю сибирскую (все половозрастные группы):",
            options: ["с 15 сентября по 10 января", "с 1 октября по 10 января", "с 20 августа по 20 сентября"],
            correct: "с 1 октября по 10 января"
        },
        {
            question: "Охота на взрослых самцов косули сибирской разрешена в период:",
            options: ["с 20 мая по 20 июня", "с 20 августа по 20 сентября", "с 15 июля по 15 августа"],
            correct: "с 20 августа по 20 сентября"
        },
        {
            question: "Сроки охоты на оленя благородного (все половозрастные группы):",
            options: ["с 15 сентября по 10 января", "с 1 октября по 10 января", "с 1 сентября по 31 декабря"],
            correct: "с 1 октября по 10 января"
        },
        {
            question: "Охота на взрослых самцов оленя благородного разрешена:",
            options: ["с 1 октября по 10 января", "с 1 сентября по 30 сентября", "с 15 сентября по 15 октября"],
            correct: "с 1 сентября по 30 сентября"
        },
        {
            question: "Охота на взрослых самцов оленя благородного с неокостеневшими рогами (пантами) разрешена в период:",
            options: ["с 1 сентября по 30 сентября", "с 1 июня по 15 июля", "с 1 августа по 31 августа"],
            correct: "с 1 июня по 15 июля"
        },
        {
            question: "Сроки охоты на дикого северного оленя (все половозрастные группы):",
            options: ["с 1 сентября по 31 января", "с 1 августа по 31 января (продолжительностью не менее 90 дней)", "с 1 октября по 31 декабря"],
            correct: "с 1 августа по 31 января (продолжительностью не менее 90 дней)"
        },
        {
            question: "Список лиц, участвующих в коллективной охоте на копытных животных должен содержать:",
            options: ["только количество участников", "фамилии и инициалы, серии и номера охотничьих билетов лиц, участвующих в коллективной охоты", "только данные руководителя группы"],
            correct: "фамилии и инициалы, серии и номера охотничьих билетов лиц, участвующих в коллективной охоты"
        },
        {
            question: "Коллективная охота на копытных животных требует:",
            options: ["только устного согласования", "составление списка лиц, участвующих в коллективной охоте, с указанием фамилий и инициалов лиц, участвующих в коллективной охоте, также серий и номеров их охотничьих билетов", "только разрешения егерской службы"],
            correct: "составление списка лиц, участвующих в коллективной охоте, с указанием фамилий и инициалов лиц, участвующих в коллективной охоте, также серий и номеров их охотничьих билетов"
        },
        {
            question: "Лицо, ответственное за осуществление коллективной охоты на копытных, обязано:",
            options: ["присутствовать в месте осуществления коллективной охоты", "может передать свои права любому участнику", "не участвует в охоте лично"],
            correct: "присутствовать в месте осуществления коллективной охоты"
        },
        {
            question: "При осуществлении охоты на медведей охотник обязан иметь при себе:",
            options: ["только охотничий билет", "охотничий билет и разрешение на добычу охотничьих ресурсов, выданное в соответствии с установленным порядком", "охотничий билет и путевку"],
            correct: "охотничий билет и разрешение на добычу охотничьих ресурсов, выданное в соответствии с установленным порядком"
        },
        {
            question: "При осуществлении охоты на медведей в закрепленных охотничьих угодьях, помимо разрешения на добычу охотничьих ресурсов, выданного в соответствии с установленным порядком, требуется:",
            options: ["путевка", "согласие местных властей", "разрешение охотпользователя"],
            correct: "путевка"
        },
        {
            question: "Список лиц, участвующих в коллективной охоте на медведя должен содержать:",
            options: ["дату выдачи разрешения и место охоты", "фамилии, инициалы всех участников коллективной охоты, а также серии и номера их охотничьих билетов", "срок отчета о добыче"],
            correct: "фамилии, инициалы всех участников коллективной охоты, а также серии и номера их охотничьих билетов"
        },
        {
            question: "После добычи медведя в разрешении на его добычу необходимо указать:",
            options: ["только количество добытых медведей", "дату, место, вид и пол добытого животного", "только локацию охоты"],
            correct: "дату, место, вид и пол добытого животного"
        },
        {
            question: "Срок предоставления сведений о добыче медведя:",
            options: ["не регламентирован", "до окончания сезона", "в течение 10 дней после добычи или в течение 10 дней после окончания последнего из сроков осуществления охоты, указанного в разрешении на добычу медведей"],
            correct: "в течение 10 дней после добычи или в течение 10 дней после окончания последнего из сроков осуществления охоты, указанного в разрешении на добычу медведей"
        },
        {
            question: "Нарушение сроков представления сведений о добыче грозит:",
            options: ["штрафом", "отказом в выдаче разрешений на добычу охотничьих ресурсов в течение года", "предупреждением"],
            correct: "отказом в выдаче разрешений на добычу охотничьих ресурсов в течение года"
        },
        {
            question: "Добор раненого медведя:",
            options: ["не обязателен", "обязателен", "обязателен в течение трех суток, не считая дня ранения"],
            correct: "обязателен в течение трех суток, не считая дня ранения"
        },
        {
            question: "Использование капканов для добычи медведя:",
            options: ["разрешено", "запрещено", "разрешено только с разрешения управления охотничьего хозяйства"],
            correct: "запрещено"
        },
        {
            question: "При доборе раненого медведя в закреплённых охотничьих угодьях, не указанных в разрешении на добычу медведя лицо, на чье имя выдано разрешение на добычу охотничьих ресурсов, любым доступным способом уведомляет:",
            options: ["управление охотничьего хозяйства", "охотпользователя", "государственного инспектора, закрепленного за конкретным муниципальным районом"],
            correct: "охотпользователя"
        },
        {
            question: "При доборе раненого медведя в общедоступных охотничьих угодьях, не указанных в разрешении на добычу медведя лицо, на чье имя выдано разрешение на добычу охотничьих ресурсов, любым доступным способом уведомляет:",
            options: ["орган государственной власти субъекта Российской Федерации, осуществляющий федеральный государственный охотничий контроль (надзор) на территории субъекта Российской Федерации", "охотпользователя", "государственного инспектора органа государственной власти субъекта Российской Федерации, осуществляющего федеральный государственный охотничий контроль (надзор), закреплённого за районом"],
            correct: "орган государственной власти субъекта Российской Федерации, осуществляющий федеральный государственный охотничий контроль (надзор) на территории субъекта Российской Федерации"
        },
        {
            question: "Сроки охоты на зайца (беляк, русак, толай, маньчжурский), дикого кролика, лисицу, корсака, енотовидную собаку:",
            options: ["с 1 сентября по 28 февраля", "с 15 сентября по 28 (29) февраля", "с 15 октября по 15 марта"],
            correct: "с 15 сентября по 28 (29) февраля"
        },
        {
            question: "Сроки охоты на пушных животных из списка (белки, горностай, рысь, соболь и др.) с продолжительностью не менее 120 дней:",
            options: ["с 1 ноября по 28 февраля", "с 15 октября по 28 (29) февраля (не менее 120 дней)", "с 1 сентября по 31 декабря"],
            correct: "с 15 октября по 28 (29) февраля (не менее 120 дней)"
        },
        {
            question: "Использование сетей при охоте на пушных животных:",
            options: ["разрешено без ограничений", "запрещено, за исключением случаев, установленных Правилами охоты", "разрешено только для научных целей"],
            correct: "запрещено, за исключением случаев, установленных Правилами охоты"
        },
        {
            question: "Охота на кротов, хомяков, ласку, водяную полевку, сусликов, бурундуков осуществляется:",
            options: ["с применением самоловов", "с применением огнестрельного оружия", "с применением петель"],
            correct: "с применением самоловов"
        },
        {
            question: "При осуществлении охоты на боровую, полевую и водоплавающую дичь в общедоступных охотничьих угодьях охотник обязан иметь при себе:",
            options: ["только охотничий билет", "охотничий билет и разрешение на добычу боровой, полевой и водоплавающей дичи", "только разрешение на добычу боровой, полевой и водоплавающей дичи"],
            correct: "охотничий билет и разрешение на добычу боровой, полевой и водоплавающей дичи"
        },
        {
            question: "При осуществлении охоты на боровую, полевую и водоплавающую дичь в закреплённых охотничьих угодьях охотник обязан иметь при себе:",
            options: ["только охотничий билет", "охотничий билет, разрешение на добычу боровой, полевой и водоплавающей дичи и путевку", "только охот билет и разрешение на добычу боровой, полевой и водоплавающей дичи"],
            correct: "охотничий билет, разрешение на добычу боровой, полевой и водоплавающей дичи и путевку"
        },
        {
            question: "К болотно-луговой дичи относятся:",
            options: ["дупеля, бекасы, гаршнеп, турухтан, травник, чибис, тулес, улиты, веретенники, кроншнепы, мородунка, камнешарка, коростель, пастушок, обыкновенный погоныш", "гуси, казарки, утки, лысуха, камышница", "серая и бородатая куропатки, перепела, саджа, фазаны, голуби и горлицы"],
            correct: "дупеля, бекасы, гаршнеп, турухтан, травник, чибис, тулес, улиты, веретенники, кроншнепы, мородунка, камнешарка, коростель, пастушок, обыкновенный погоныш"
        },
        {
            question: "К водоплавающей дичи относятся:",
            options: ["серая и бородатая куропатки, перепела, саджа, фазаны, голуби и горлицы", "гуси, казарки, утки, лысуха, камышница", "дупеля, бекасы, гаршнеп, турухтан, травник, чибис, тулес, улиты, веретенники, кроншнепы"],
            correct: "гуси, казарки, утки, лысуха, камышница"
        },
        {
            question: "Охота на рябчика разрешена:",
            options: ["в период с третьей субботы августа по 28 (29) февраля в течение единого непрерывного срока не менее 120 дней", "в период с третьей субботы августа по 20 апреля в течение единого непрерывного срока не менее 150 дней", "в период со второй субботы августа по 31 декабря в течение единого непрерывного срока не менее 90 дней"],
            correct: "в период с третьей субботы августа по 28 (29) февраля в течение единого непрерывного срока не менее 120 дней"
        },
        {
            question: "Охота на водоплавающую, болотно-луговую, степную и полевую дичь разрешена:",
            options: ["в период с третьей субботы августа по 28 (29) февраля в течение единого непрерывного срока не менее 120 дней", "в период с третьей субботы августа по 20 апреля в течение единого непрерывного срока не менее 150 дней", "в период со второй субботы августа по 31 декабря в течение единого непрерывного срока не менее 90 дней"],
            correct: "в период со второй субботы августа по 31 декабря в течение единого непрерывного срока не менее 90 дней"
        },
        {
            question: "Использование любых плавательных средств в период осуществления весенней охоты при охоте на водоплавающую дичь:",
            options: ["разрешено без ограничений", "разрешено для подбора и транспортирования добытой дичи", "запрещено"],
            correct: "разрешено для подбора и транспортирования добытой дичи"
        },
        {
            question: "При осуществлении охоты запрещается:",
            options: ["добыча охотничьих животных, находящихся в бедственном положении, беспомощном состоянии", "применение ловчих птиц", "использование плавательных средств"],
            correct: "добыча охотничьих животных, находящихся в бедственном положении, беспомощном состоянии"
        },
        {
            question: "Охота на болотно-луговую дичь с островными и континентальными легавыми собаками, ретриверами, спаниелями имеющими справку или свидетельство о происхождении, осуществляется:",
            options: ["в период с 5 августа по 28 (29) февраля в течение единого непрерывного срока не менее 150 дней", "в период с 25 июля по 31 декабря в течение единого непрерывного срока не менее 120 дней", "в период со второй субботы августа по 31 декабря"],
            correct: "в период с 25 июля по 31 декабря в течение единого непрерывного срока не менее 120 дней"
        },
        {
            question: "Охота на водоплавающую дичь с островными и континентальными легавыми собаками, ретриверами, спаниелями, имеющими справку или свидетельство о происхождении, осуществляется:",
            options: ["в период с 5 августа по 28 (29) февраля в течение единого непрерывного срока не менее 150 дней", "в период с 25 июля по 31 декабря в течение единого непрерывного срока не менее 120 дней", "в период со второй субботы августа по 31 декабря"],
            correct: "в период со второй субботы августа по 31 декабря"
        },
        {
            question: "В случаях, когда собака охотничьей породы ушла за охотничьим животным (за пределы охотничьих угодий, на территорию которых у охотника имеется соответствующее разрешение на добычу охотничьих ресурсов), охотник при поиске и отзыве собаки охотничьей породы на другой территории обязан:",
            options: ["держать патроны (снаряды) отдельно от зачехленного и разряженного охотничьего огнестрельного (пневматического) оружия", "носить оружие в зачехленном и разобранном состоянии", "предупредить охотпользователя о своем нахождении на территории охотничьих угодий"],
            correct: "держать патроны (снаряды) отдельно от зачехленного и разряженного охотничьего огнестрельного (пневматического) оружия"
        },
        {
            question: "Применение тепловизоров, приборов ночного видения при осуществлении охоты с использованием охотничьего метательного стрелкового оружия:",
            options: ["разрешено", "запрещено", "разрешено только с вышки"],
            correct: "запрещено"
        },
        {
            question: "Применение любых световых устройств для добычи пернатой дичи при любительской и спортивной охоте:",
            options: ["запрещено", "разрешено", "разрешена только в ночное время"],
            correct: "запрещено"
        },
        {
            question: "Применение любых световых устройств, тепловизоров, приборов ночного видения для добычи охотничьих животных:",
            options: ["разрешено", "запрещено", "запрещено, за исключением случаев добычи в темное время суток: копытных животных, медведей, волка, шакала, лисицы, енотовидной собаки, барсука, бобров с соблюдением требований, установленных Правилами охоты"],
            correct: "запрещено, за исключением случаев добычи в темное время суток: копытных животных, медведей, волка, шакала, лисицы, енотовидной собаки, барсука, бобров с соблюдением требований, установленных Правилами охоты"
        },
        {
            question: "Применение механических транспортных средств и любых летательных аппаратов при осуществлении любительской и спортивной охоты:",
            options: ["запрещено", "разрешено", "разрешено только для добычи волка"],
            correct: "запрещено"
        },
        {
            question: "Сразу после добычи копытного животного, до начала его первичной переработки или транспортировки, охотник:",
            options: ["заполняет раздел «Сведения о добыче копытного животного»", "отделяет от разрешения на добычу охотничьих ресурсов поле «ДОБЫЧА» и заполняет раздел «Сведения о добыче копытного животного»", "отделяет от разрешения на добычу охотничьих ресурсов поле «ДОБЫЧА» и делает запись о дате добычи"],
            correct: "отделяет от разрешения на добычу охотничьих ресурсов поле «ДОБЫЧА» и заполняет раздел «Сведения о добыче копытного животного»"
        },
        {
            question: "В случае ранения копытного животного (наличие крови или иные признаки попадания) до начала его дальнейшего преследования охотник:",
            options: ["отмечает в разделе «Сведения о добыче копытного животного» разрешения на добычу охотничьих ресурсов дату ранения, после чего осуществляет добор раненого животного", "отмечает в разделе «Сведения о добыче копытного животного» разрешения на добычу охотничьих ресурсов дату ранения и отделяет поле «РАНЕНИЕ», после чего осуществляет добор раненого животного", "отделяет от разрешения на добычу охотничьих ресурсов поле «РАНЕНИЕ», после чего осуществляет добор раненого животного"],
            correct: "отмечает в разделе «Сведения о добыче копытного животного» разрешения на добычу охотничьих ресурсов дату ранения и отделяет поле «РАНЕНИЕ», после чего осуществляет добор раненого животного"
        },
        {
            question: "При доборе раненого копытного животного разрешается заходить в охотничьи угодья, не указанные в разрешении на добычу охотничьих ресурсов:",
            options: ["предварительно сделав в разрешении на добычу охотничьих ресурсов отметку о ранении охотничьего животного", "получив письменное разрешение у охотпользователя", "с зачехленным и разряженным оружием"],
            correct: "предварительно сделав в разрешении на добычу охотничьих ресурсов отметку о ранении охотничьего животного"
        },
        {
            question: "При осуществлении охоты запрещается:",
            options: ["использование стандартных ногозахватывающих удерживающих капканов со стальными дугами для отлова рыси, барсука, лесной куницы, соболя, горностая, выдры, бобров, ондатры", "использование стандартных ногозахватывающих удерживающих капканов со стальными дугами для отлова волка, енотовидной собаки, енота-полоскуна, рыси, барсука, лесной куницы, соболя, горностая, выдры, бобров, ондатры", "использование стандартных ногозахватывающих удерживающих капканов со стальными дугами для отлова волка, енотовидной собаки, енота-полоскуна, выдры, бобров, ондатры"],
            correct: "использование стандартных ногозахватывающих удерживающих капканов со стальными дугами для отлова волка, енотовидной собаки, енота-полоскуна, рыси, барсука, лесной куницы, соболя, горностая, выдры, бобров, ондатры"
        },
        {
            question: "При осуществлении охоты запрещается (выберите наиболее полный ответ):",
            options: ["добыча кабанов загоном, нагоном, а также с применением собак охотничьих пород с 1 января по 28 (29) февраля, за исключением добора раненых кабанов", "добыча кабанов загоном, нагоном, с 1 января по 28 (29) февраля, за исключением добора раненых кабанов", "добыча кабанов загоном, нагоном, а также с применением собак охотничьих пород с 1 января по 28 (29) февраля"],
            correct: "добыча кабанов загоном, нагоном, а также с применением собак охотничьих пород с 1 января по 28 (29) февраля, за исключением добора раненых кабанов"
        },
        {
            question: "При осуществлении охоты запрещается:",
            options: ["применение сетей и других ловчих приспособлений из сетей для добычи копытных", "применение сетей и других ловчих приспособлений из сетей при добыче норки и ондатры верш (мордушек), изготовленных из сетки с размером ячеи не менее 50 миллиметров", "применение обметов при добыче соболя и куницы"],
            correct: "применение сетей и других ловчих приспособлений из сетей для добычи копытных"
        },
        {
            question: "При осуществлении охоты запрещается:",
            options: ["применение самоловов для добычи пушных животных", "применение самоловов для добычи копытных животных и медведей", "применение обметов при добыче соболя и куницы"],
            correct: "применение самоловов для добычи копытных животных и медведей"
        },
        {
            question: "При осуществлении охоты запрещается:",
            options: ["осуществление охоты в период весенней охоты с подхода, за исключением охоты на тетерева", "осуществление охоты в период весенней охоты с подхода, за исключением охоты на гусей", "осуществление охоты в период весенней охоты с подхода, за исключением охоты на глухаря на току и на медведя"],
            correct: "осуществление охоты в период весенней охоты с подхода, за исключением охоты на глухаря на току и на медведя"
        },
        {
            question: "При осуществлении охоты запрещается:",
            options: ["осуществление охоты на водоплавающую и боровую дичь в период весенней охоты", "осуществление охоты в период весенней охоты с подхода, за исключением охоты на гусей", "осуществление охоты на рябчиков, лысуху, камышницу, серого гуся, белую и тундряную куропатку, на вальдшнепа на утренней тяге в период весенней охоты"],
            correct: "осуществление охоты на рябчиков, лысуху, камышницу, серого гуся, белую и тундряную куропатку, на вальдшнепа на утренней тяге в период весенней охоты"
        },
        {
            question: "При осуществлении охоты запрещается:",
            options: ["находится с расчехленным охотничьим оружием ближе 200 метров от жилого дома, жилого строения", "осуществлять добычу охотничьих животных с применением охотничьего оружия ближе 200 метров от жилого дома, жилого строения", "уничтожать выводковые норы и логовища волков, шакалов"],
            correct: "осуществлять добычу охотничьих животных с применением охотничьего оружия ближе 200 метров от жилого дома, жилого строения"
        },
        {
            question: "При осуществлении охоты запрещается:",
            options: ["стрелять «на шум», «на шорох», по неясно видимой цели", "осуществлять добычу охотничьих животных с применением собак охотничьих пород", "уничтожать выводковые норы и логовища волков, шакалов"],
            correct: "стрелять «на шум», «на шорох», по неясно видимой цели"
        },
        {
            question: "При осуществлении охоты запрещается:",
            options: ["стрелять по пернатой дичи, сидящей на проводах и опорах (столбах) линий электропередач", "осуществлять добычу охотничьих животных с применением собак охотничьих пород", "уничтожать выводковые норы и логовища волков, шакалов"],
            correct: "стрелять по пернатой дичи, сидящей на проводах и опорах (столбах) линий электропередач"
        },
        {
            question: "При осуществлении охоты запрещается:",
            options: ["стрелять вдоль линии стрелков (когда снаряд может пройти ближе, чем 15 метров от соседнего стрелка)", "осуществлять добычу охотничьих животных с применением собак охотничьих пород", "уничтожать выводковые норы и логовища волков, шакалов"],
            correct: "стрелять вдоль линии стрелков (когда снаряд может пройти ближе, чем 15 метров от соседнего стрелка)"
        },
        {
            question: "При осуществлении охоты запрещается:",
            options: ["стрелять по информационным знакам, в том числе дорожным знакам, знакам дорожного движения, межевым знакам, рекламным конструкциям (стендам, щитам), а также специальным информационным знакам (аншлагам) и иным информационным знакам и их опорам, жилым и нежилым помещениям", "осуществлять добычу охотничьих животных с применением чучел и манков", "уничтожать выводковые норы и логовища волков, шакалов"],
            correct: "стрелять по информационным знакам, в том числе дорожным знакам, знакам дорожного движения, межевым знакам, рекламным конструкциям (стендам, щитам), а также специальным информационным знакам (аншлагам) и иным информационным знакам и их опорам, жилым и нежилым помещениям"
        },
        {
            question: "При осуществлении охоты запрещается:",
            options: ["осуществлять добычу охотничьих животных с применением чучел и манков", "стрелять ниже 2,5 метров по взлетающей и летящей птице при осуществлении охоты в зарослях, кустах и ограниченном обзоре местности", "уничтожать выводковые норы и логовища волков, шакалов"],
            correct: "стрелять ниже 2,5 метров по взлетающей и летящей птице при осуществлении охоты в зарослях, кустах и ограниченном обзоре местности"
        },
        {
            question: "При осуществлении охоты запрещается:",
            options: ["осуществлять добычу охотничьих животных с применением чучел и манков", "сходить со стрелковой позиции, подходить к упавшему, добытому, раненому охотничьему животному до окончания загона при осуществлении коллективной охоты", "уничтожать выводковые норы и логовища волков, шакалов"],
            correct: "сходить со стрелковой позиции, подходить к упавшему, добытому, раненому охотничьему животному до окончания загона при осуществлении коллективной охоты"
        },
        {
            question: "Проверка боя охотничьего оружия и приведение его к нормальному бою (пристрелка) должна производиться:",
            options: ["только на специально оборудованных стрельбищах или площадках", "на специально оборудованных стрельбищах или площадках, либо в охотничьих угодьях только в период охоты при наличии у охотника документов на право осуществления охоты", "по согласованию с охотпользователем или органом государственной власти субъекта Российской Федерации, осуществляющим федеральный государственный охотничий контроль (надзор) на территории субъекта Российской Федерации"],
            correct: "на специально оборудованных стрельбищах или площадках, либо в охотничьих угодьях только в период охоты при наличии у охотника документов на право осуществления охоты"
        },
        {
            question: "Транспортировка продукции охоты допускается при наличии:",
            options: ["охотничьего билета", "разрешения на добычу охотничьих ресурсов с заполненными сведениями о добыче таких охотничьих ресурсов или отрывного талона к указанному разрешению", "путевки"],
            correct: "разрешения на добычу охотничьих ресурсов с заполненными сведениями о добыче таких охотничьих ресурсов или отрывного талона к указанному разрешению"
        },
        {
            question: "Если в разрешении на добычу охотничьих ресурсов указана норма добычи более одной особи охотничьих животных в день, для транспортировки продукции достаточно:",
            options: ["любого документа", "разрешения на добычу охотничьих ресурсов без заполненных сведений о добыче", "только охотничьего билета"],
            correct: "разрешения на добычу охотничьих ресурсов без заполненных сведений о добыче"
        },
        {
            question: "Продукция охоты не подлежит перевозке без:",
            options: ["упаковки", "документов, подтверждающих легальность добычи охотничьих ресурсов", "сопровождения егеря"],
            correct: "документов, подтверждающих легальность добычи охотничьих ресурсов"
        },
        {
            question: "Впадает ли медведь в зимний сон:",
            options: ["да", "нет", "иногда"],
            correct: "да"
        },
        {
            question: "К охотничьим ресурсам на территории Российской Федерации не относятся:",
            options: ["копытные животные", "пушные животные", "водные биологические ресурсы"],
            correct: "водные биологические ресурсы"
        },
        {
            question: "Какой из перечисленных видов не относится к охотничьим ресурсам:",
            options: ["рыжая полевка", "водяная полевка", "крот"],
            correct: "рыжая полевка"
        },
        {
            question: "В какой период осуществляется гон у лосей:",
            options: ["весенний", "зимний", "осенний"],
            correct: "осенний"
        },
        {
            question: "Для кого обязательны для исполнения Правила охоты:",
            options: ["для физических лиц", "для юридических лиц осуществляющих виды деятельности в сфере охотничьего хозяйства", "для физических лиц и юридических лиц, осуществляющих виды деятельности в сфере охотничьего хозяйства, за исключением деятельности по оказанию услуг и иной деятельности в сфере охотничьего хозяйства в целях любительской и спортивной охоты в отношении охотничьих ресурсов, находящихся в полувольных условиях и искусственно созданной среде обитания"],
            correct: "для физических лиц и юридических лиц, осуществляющих виды деятельности в сфере охотничьего хозяйства, за исключением деятельности по оказанию услуг и иной деятельности в сфере охотничьего хозяйства в целях любительской и спортивной охоты в отношении охотничьих ресурсов, находящихся в полувольных условиях и искусственно созданной среде обитания"
        },
        {
            question: "Что обязан иметь при себе охотник в случае осуществления охоты в закрепленных охотничьих угодьях с охотничьим огнестрельным и (или) пневматическим оружием:",
            options: ["разрешение на добычу охотничьих ресурсов и разрешение на хранение и ношение охотничьего оружия", "разрешение на добычу охотничьих ресурсов, также путевку, разрешение на хранение и ношение охотничьего оружия", "охотничий билет, разрешение на добычу охотничьих ресурсов, также путевку, разрешение на хранение и ношение охотничьего оружия"],
            correct: "охотничий билет, разрешение на добычу охотничьих ресурсов, также путевку, разрешение на хранение и ношение охотничьего оружия"
        },
        {
            question: "Какие документы охотник обязан предъявлять производственному охотничьему инспектору по его требованию, в случае осуществления охоты в закрепленных охотничьих угодьях с охотничьим огнестрельным и (или) пневматическим оружием :",
            options: ["охотничий билет, разрешение на добычу охотничьих ресурсов, также путевку, разрешение на хранение и ношение охотничьего оружия", "паспорт, водительское удостоверение, охотничий билет", "охотничий билет, разрешение на хранение и ношение охотничьего оружия"],
            correct: "охотничий билет, разрешение на добычу охотничьих ресурсов, также путевку, разрешение на хранение и ношение охотничьего оружия"
        },
        {
            question: "Какие вещи охотник обязан предъявлять производственному охотничьему инспектору по его требованию для осмотра, в случае осуществления охоты в закрепленных охотничьих угодьях:",
            options: ["орудия охоты, продукцию охоты", "продукцию охоты", "вещи, находящиеся при себе, орудия охоты, продукцию охоты и транспортные средства"],
            correct: "вещи, находящиеся при себе, орудия охоты, продукцию охоты и транспортные средства"
        },
        {
            question: "В какие сроки охоты осуществляется охота на лося в возрасте до 1 года:",
            options: ["с 15 сентября по 10 января", "с 15 сентября по 10 января (продолжительность охоты не более 90 дней)", "с 1 сентября по 1 января"],
            correct: "с 15 сентября по 10 января (продолжительность охоты не более 90 дней)"
        },
        {
            question: "Можно ли применять охотничье огнестрельное гладкоствольное оружие при обучении (натаске и нагонке) собак охотничьих пород в закрепленных охотничьих угодьях:",
            options: ["только в открытые сроки охоты, на участках закреплённых охотничьих угодий указанных в путёвке", "нельзя", "можно только в зонах нагонки и натаски, которые определены в документах территориального охотустройства"],
            correct: "можно только в зонах нагонки и натаски, которые определены в документах территориального охотустройства"
        },
        {
            question: "Обязан ли охотник при осуществлении охоты в закрепленных охотничьих угодьях с собаками охотничьих пород иметь при себе путевку:",
            options: ["обязан", "не обязан", "обязан, за исключением случаев обучения (натаски и нагонки) собак охотничьих пород, в зонах нагонки и натаски, которые определены в документах территориального охотустройства"],
            correct: "обязан, за исключением случаев обучения (натаски и нагонки) собак охотничьих пород, в зонах нагонки и натаски, которые определены в документах территориального охотустройства"
        },
        {
            question: "Запрещается ли добыча охотничьих животных находящихся в бедственном положении:",
            options: ["не запрещается", "запрещается, за исключением добычи волка, шакала и ворон (серой, черной и большеклювой), в случае отнесения последних законами субъектов Российской Федерации к охотничьим ресурсам", "запрещается"],
            correct: "запрещается, за исключением добычи волка, шакала и ворон (серой, черной и большеклювой), в случае отнесения последних законами субъектов Российской Федерации к охотничьим ресурсам"
        },
        {
            question: "Добыча медведей, какого возраста запрещена :",
            options: ["до одного года", "до двух лет", "до трех лет"],
            correct: "до одного года"
        },
        {
            question: "Запрещается ли стрельба дробью или картечью по копытным животным :",
            options: ["не запрещается, за исключением использования дроби (картечи) диаметром менее 7,5 миллиметров для стрельбы по лосю, овцебыку, гибридам зубра с бизоном, домашним скотом", "не запрещается по любым видам копытных животных", "запрещается, за исключением использования дроби (картечи) диаметром не менее 5 миллиметров для стрельбы по кабарге, косулям и дикому северному оленю и диаметром не менее 7,5 миллиметров для стрельбы по кабану"],
            correct: "запрещается, за исключением использования дроби (картечи) диаметром не менее 5 миллиметров для стрельбы по кабарге, косулям и дикому северному оленю и диаметром не менее 7,5 миллиметров для стрельбы по кабану"
        },
        {
            question: "Разрешается ли применение настороженного огнестрельного оружия, самострелов, падающих пик, ловчих ям для добычи охотничьих животных:",
            options: ["разрешается", "не разрешается", "разрешается только в закрепленных охотничьих угодьях"],
            correct: "не разрешается"
        },
        {
            question: "Разрешается ли применение световых устройств для добычи пернатой дичи:",
            options: ["разрешается только в общедоступных охотничьих угодьях в летне-осенний период", "разрешается только в закрепленных охотничьих угодьях в летне-осенний период", "запрещается, за исключением случаев осуществления охоты в целях регулирования численности, акклиматизации, переселения и гибридизации, содержания и разведения охотничьих ресурсов в полувольных условиях или искусственно созданной среде обитания, осуществления научно-исследовательской деятельности, образовательной деятельности"],
            correct: "запрещается, за исключением случаев осуществления охоты в целях регулирования численности, акклиматизации, переселения и гибридизации, содержания и разведения охотничьих ресурсов в полувольных условиях или искусственно созданной среде обитания, осуществления научно-исследовательской деятельности, образовательной деятельности"
        },
        {
            question: "Разрешается ли применение любых световых устройств, тепловизоров, приборов ночного видения для добычи копытных животных, медведей, пушных животных:",
            options: ["запрещается, за исключением случаев добычи в темное время суток: копытных животных, медведей, волка, шакала, лисицы, енотовидной собаки, барсука, бобров, с соблюдением требований, установленных Правилами охоты", "разрешается только в закрепленных охотничьих угодьях в летне-осенний период, в темное время суток", "разрешается только в общедоступных охотничьих угодьях в летне-осенний период, при осуществлении коллективной охоты"],
            correct: "запрещается, за исключением случаев добычи в темное время суток: копытных животных, медведей, волка, шакала, лисицы, енотовидной собаки, барсука, бобров, с соблюдением требований, установленных Правилами охоты"
        },
        {
            question: "Разрешается ли применение при отлове и (или) отстреле охотничьих животных электронных устройств, имитирующих звуки, издаваемые охотничьими животными и иными животными:",
            options: ["разрешается только в закрепленных охотничьих угодьях в летне-осенний период при осуществлении любительской и спортивной охоты на водоплавающую дичь", "запрещается, за исключением осуществления охоты в целях осуществления научно-исследовательской деятельности, в целях акклиматизации, переселения и гибридизации охотничьих ресурсов, содержания и разведения охотничьих ресурсов в полувольных условиях или искусственно созданной среде обитания, охоты в целях регулирования численности, а также охоты на волка, шакала, ворон (серой, черной и большеклювой), в случае отнесения последних законами субъектов Российской Федерации к охотничьим ресурсам", "разрешается только в закрепленных охотничьих угодьях в весенний период при осуществлении любительской и спортивной охоты на водоплавающую дичь"],
            correct: "запрещается, за исключением осуществления охоты в целях осуществления научно-исследовательской деятельности, в целях акклиматизации, переселения и гибридизации охотничьих ресурсов, содержания и разведения охотничьих ресурсов в полувольных условиях или искусственно созданной среде обитания, охоты в целях регулирования численности, а также охоты на волка, шакала, ворон (серой, черной и большеклювой), в случае отнесения последних законами субъектов Российской Федерации к охотничьим ресурсам"
        },
        {
            question: "К какому виду пернатой дичи относятся вальдшнеп и тундряная куропатка:",
            options: ["к степной и полевой дичи", "к боровой дичи", "к болотно-луговой дичи"],
            correct: "к боровой дичи"
        },
        {
            question: "К какому виду пернатой дичи относится серая куропатка:",
            options: ["к степной и полевой дичи", "к боровой дичи", "к болотно-луговой дичи"],
            correct: "к степной и полевой дичи"
        },
        {
            question: "Охота на вальдшнепа в период весенней охоты осуществляется",
            options: ["на утренней тяге", "на вечерней тяге", "оба ответа правильные"],
            correct: "на вечерней тяге"
        },
        {
            question: "На какую боровую дичь запрещена охота с применением охотничьего огнестрельного оружия с нарезным стволом:",
            options: ["вальдшнеп", "глухарь, тетерев", "оба ответа правильные"],
            correct: "вальдшнеп"
        },
        {
            question: "С участием какого количества охотников осуществляется охота на пернатую дичь с одной легавой собакой:",
            options: ["не более 3 охотников", "не менее 3 охотников", "количество не ограничено"],
            correct: "не более 3 охотников"
        }
    ];
    questionBank.forEach(q => {
        q.correct = simpleHash(q.correct.trim());
    });
    const effectiveQuestionsInTest = Math.min(QUESTIONS_TO_SHOW, questionBank.length);
    let timerInterval = null;

    document.addEventListener('contextmenu', event => event.preventDefault());
    window.onbeforeunload = e => localStorage.getItem('testInProgress') ? "Вы уверены, что хотите покинуть страницу?" : undefined;
    
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('userName').addEventListener('input', e => clearError(e.target));
        document.getElementById('userPassport').addEventListener('input', e => clearError(e.target));
        const mainTitle = document.getElementById('mainTitle');
        let clickCount = 0;
        let clickTimer = null;
        mainTitle.addEventListener('click', () => {
            clickCount++;
            if (clickCount === 1) {
                clickTimer = setTimeout(() => { clickCount = 0; }, 600);
            } else if (clickCount === 3) {
                clearTimeout(clickTimer);
                clickCount = 0;
                showLog();
            }
        });
    });

    function checkForSavedTest() { if (localStorage.getItem('testInProgress')) { const state = JSON.parse(localStorage.getItem('quizState')); document.getElementById('startScreen').style.display = 'none'; document.getElementById('setup').style.display = 'none'; renderQuiz(state.selectedQuestions, state.userAnswers); startTimer(state.endTime); } }
    function initiateTest() { document.documentElement.requestFullscreen().catch(err => console.log(`Fullscreen error: ${err.message}`)); document.getElementById('startScreen').style.display = 'none'; document.getElementById('setup').style.display = 'block'; document.getElementById('timeWarning').innerText = `Внимание! На прохождение теста отводится ${TIME_FOR_TEST_MINUTES} минут.`; }
    function showError(inputElement, message) { const errorElement = document.getElementById(inputElement.id + 'Error'); inputElement.classList.add('input-error'); errorElement.textContent = message; errorElement.style.display = 'block'; }
    function clearError(inputElement) { const errorElement = document.getElementById(inputElement.id + 'Error'); inputElement.classList.remove('input-error'); errorElement.style.display = 'none'; }
    function shuffle(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } return array; }
    function simpleHash(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
            const char = str.charCodeAt(i);
            hash = (hash << 5) - hash + char;
            hash |= 0; // Convert to 32bit integer
        }
        return (hash >>> 0).toString(16);
    }

    function startTest() {
        const userNameInput = document.getElementById('userName');
        const userPassportInput = document.getElementById('userPassport');
        let isValid = true;
        clearError(userNameInput); clearError(userPassportInput);
        const namePattern = /^[А-Яа-яЁё\s,-]+$/;
        const passportPattern = /^\d{4}\s\d{6}$/;
        if (!namePattern.test(userNameInput.value) || userNameInput.value.trim() === "") { showError(userNameInput, userNameInput.title); isValid = false; }
        if (!passportPattern.test(userPassportInput.value)) { showError(userPassportInput, userPassportInput.title); isValid = false; }
        if (!isValid) return;
        const userName = userNameInput.value.trim();
        const userPassport = userPassportInput.value.trim();
        document.getElementById('setup').style.display = 'none';
        const selectedQuestions = shuffle([...questionBank]).slice(0, effectiveQuestionsInTest);
        selectedQuestions.forEach(q => q.shuffledOptions = shuffle([...q.options]));
        const endTime = Date.now() + TIME_FOR_TEST_MINUTES * 60 * 1000;
        const initialState = { userName, userPassport, selectedQuestions, userAnswers: {}, endTime, id: Date.now() };
        localStorage.setItem('quizState', JSON.stringify(initialState));
        localStorage.setItem('testInProgress', 'true');
        renderQuiz(selectedQuestions);
        startTimer(endTime);
    }

    function renderQuiz(questions, answers = {}) {
        const quizContainer = document.getElementById('quiz');
        quizContainer.innerHTML = '';
        questions.forEach((q, index) => {
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question';
            let optionsHTML = '';
            q.shuffledOptions.forEach(option => {
                const isChecked = answers[index] === option ? 'checked' : '';
                optionsHTML += `<label><input type="radio" name="q${index}" value="${option}" onchange="saveAnswer(${index}, this.value)" ${isChecked}> ${option}</label>`;
            });
            questionDiv.innerHTML = `<h4>Вопрос ${index + 1}: ${q.question}</h4><div class="options">${optionsHTML}</div>`;
            quizContainer.appendChild(questionDiv);
        });
        quizContainer.style.display = 'block';
        document.getElementById('submitBtn').style.display = 'block';
        updateProgress();
    }
    
    function updateProgress() { const state = getQuizState(); if (!state) return; const answeredCount = Object.keys(state.userAnswers).length; document.getElementById('progress-indicator').innerText = `Отвечено: ${answeredCount} из ${effectiveQuestionsInTest}`; document.getElementById('progress-indicator').style.display = 'block'; }
    function saveAnswer(questionIndex, answerValue) { const state = getQuizState(); state.userAnswers[questionIndex] = answerValue; localStorage.setItem('quizState', JSON.stringify(state)); updateProgress(); }
    function startTimer(endTime) { const timerEl = document.getElementById('timer'); timerEl.style.display = 'block'; function updateTimer() { const remaining = endTime - Date.now(); if (remaining <= 0) { clearInterval(timerInterval); timerEl.innerHTML = "Время вышло!"; showResults(null); return; } const minutes = Math.floor((remaining / 1000) / 60); const seconds = Math.floor((remaining / 1000) % 60); timerEl.innerHTML = `${minutes}:${seconds.toString().padStart(2, '0')}`; } updateTimer(); timerInterval = setInterval(updateTimer, 1000); }
    function getQuizState() { return JSON.parse(localStorage.getItem('quizState')); }

    function showResults(archivedState) {
        if (timerInterval) clearInterval(timerInterval);
        ['timer', 'progress-indicator'].forEach(id => document.getElementById(id).style.display = 'none');
        const state = archivedState || getQuizState();
        if (!state) return;
        
        let score = 0; 
        let errorHTML = '';
        state.selectedQuestions.forEach((q, index) => {
            const userAnswer = state.userAnswers[index];
            if (userAnswer && simpleHash(userAnswer) === q.correct) {
                score++;
            } else {
                const correctAnswerText = q.options.find(opt => simpleHash(opt) === q.correct) || "Ответ не найден";
                errorHTML += `<div class="error-item"><h4>${q.question}</h4><p>Ваш ответ: <span class="user-answer-wrong">${userAnswer || "нет ответа"}</span></p><p>Правильный ответ: <span class="correct-answer">${correctAnswerText}</span></p></div>`;
            }
        });

        const isPassed = (score / state.selectedQuestions.length) * 100 >= PASS_PERCENTAGE;
        const passStatus = isPassed ? "СДАН" : "НЕ СДАН";
        const statusClass = isPassed ? "pass" : "fail";
        const dateString = new Date(state.id).toLocaleString('ru-RU');
        const resultsContainer = document.getElementById('results');
        resultsContainer.innerHTML = `<div id="protocol-header"><h2>Протокол проверки знаний</h2><div class="protocol-line"><span>Экзаменуемый:</span><span>${state.userName}</span></div><div class="protocol-line"><span>Паспортные данные:</span><span>${state.userPassport}</span></div><div class="protocol-line"><span>Дата проведения:</span><span>${dateString}</span></div><div class="protocol-line"><span>Количество правильных ответов:</span><span>${score} из ${state.selectedQuestions.length}</span></div><div class="protocol-verdict"><h3 class="${statusClass}">РЕЗУЛЬТАТ: ${passStatus}</h3></div></div><div id="screen-only-content"><hr><p>Количество правильных ответов: ${score} из ${state.selectedQuestions.length}</p>${errorHTML ? `<button id="reviewBtn" class="secondary-button" onclick="toggleErrors()">Показать мои ошибки</button><div id="errorReview" style="display:none;"><h3>Разбор ошибок</h3>${errorHTML}</div>` : '<p>Все ответы верны!</p>'}<hr><div><button onclick="window.print()">Печать / Сохранить как PDF</button></div><span class="help-toggle" onclick="toggleHelp()">Как распечатать или сохранить файл?</span><div id="saveHelpText" style="display:none;"><h4>Инструкция:</h4><ol><li>Нажмите кнопку "Печать / Сохранить как PDF".</li><li>В окне "Принтер" выберите ваш принтер или опцию <strong>"Сохранить как PDF"</strong>.</li><li>Нажмите "Печать" или "Сохранить".</li></ol></div>${archivedState ? `<br><button class="secondary-button" onclick="showLog()">Назад к журналу</button>` : ''}</div>`;
        ['quiz', 'submitBtn', 'startScreen'].forEach(id => document.getElementById(id).style.display = 'none');
        resultsContainer.style.display = 'block';
        if (!archivedState) { saveResultToLog(state); localStorage.removeItem('quizState'); localStorage.removeItem('testInProgress'); window.onbeforeunload = null; }
    }
    
    function saveResultToLog(state) { let log = JSON.parse(localStorage.getItem('resultsLog') || '[]'); log.unshift(state); if (log.length > 50) log = log.slice(0, 50); localStorage.setItem('resultsLog', JSON.stringify(log)); }
    function showLog() { const log = JSON.parse(localStorage.getItem('resultsLog') || '[]'); const tableContainer = document.getElementById('log-table-container'); if (log.length === 0) { tableContainer.innerHTML = "<p>Журнал пуст.</p>"; } else { let tableHTML = `<table id="log-table"><tr><th>Дата</th><th>ФИО</th><th>Результат</th><th>Действие</th></tr>`; log.forEach(item => { const date = new Date(item.id).toLocaleString('ru-RU'); const score = Object.values(item.userAnswers).filter((ans, i) => simpleHash(ans) === item.selectedQuestions[i].correct).length; const isPassed = (score / item.selectedQuestions.length) * 100 >= PASS_PERCENTAGE; tableHTML += `<tr><td>${date}</td><td>${item.userName}</td><td>${isPassed ? 'Сдан' : 'Не сдан'}</td><td><button onclick="recreateResult(${item.id})">Просмотр</button></td></tr>`; }); tableHTML += `</table>`; tableContainer.innerHTML = tableHTML; } document.getElementById('log-modal').style.display = 'flex'; if (document.fullscreenElement) document.exitFullscreen(); }
    function closeLog() { document.getElementById('log-modal').style.display = 'none'; if (document.getElementById('results').style.display !== 'block') { location.reload(); } }
    function recreateResult(id) { const log = JSON.parse(localStorage.getItem('resultsLog') || '[]'); const resultToShow = log.find(item => item.id === id); if (resultToShow) { document.getElementById('log-modal').style.display = 'none'; document.getElementById('startScreen').style.display = 'none'; showResults(resultToShow); } }
    function toggleHelp() { const helpDiv = document.getElementById('saveHelpText'); helpDiv.style.display = helpDiv.style.display === 'none' ? 'block' : 'none'; }
    function toggleErrors() { const errorDiv = document.getElementById('errorReview'); const reviewBtn = document.getElementById('reviewBtn'); if (errorDiv.style.display === 'none') { errorDiv.style.display = 'block'; reviewBtn.innerText = "Скрыть ошибки"; } else { errorDiv.style.display = 'none'; reviewBtn.innerText = "Показать мои ошибки"; } }
</script>

</body>
</html>